{% extends 'hackathon/base.html' %}
{% load static %}

{% block content %}
<div class="result_container" style='margin-top: 30px'>
    <div id="result_title">
        <h2>{{ user_name }}님은</h1>
        <p>만취한 꽐라형 확찐자입니다!</p>
        <p>{{ user_height }}</p>
        <img style="width:150px;height:150px;" src="{% static 'images/drunken.png' %}"></img>
    </div>
</div>
<!-- --------------------------  -->

<div class="result_container" style="height:500px;margin-top:220px;">
    <canvas id='predict_canvas'>
    </canvas>
</div>

<div class="result_container" style="height:500px;margin-top:220px;">
    <canvas id="pieChart"></canvas>
</div>


<!-- --------------------------  -->
<div class="result_container" style="display: flex;height:700px;">
    <div class="left_graph">
        <div id='fastfoodgraph' style='height:50%;margin:10px;'>
            <canvas id='ff_canvas'></canvas>
        </div>
        <div id='banchangraph' style='height:50%;margin:10px;'>
            <canvas id='ff_banchan'></canvas>
        </div>
    </div>
    <div class="right_graph">
        <div id='dessertgraph' style='height:50%;margin:10px;'>
            <canvas id='ff_snack'></canvas>
        </div>
        <div id='drinkgraph' style='height:50%;margin:10px;'>
            <canvas id='ff_drink'></canvas>
        </div>
    </div>
</div>
<script type='text/javascript'>
    $(document).ready(function(){
        model_input = "{{ model_input|safe }}";
        user_height = "{{ user_height }}";
        user_weight = "{{ user_weight }}";
        predict_bmi = "{{ predict_bmi }}";
        

        model_input= slicing(model_input);
        user_height = slicing(user_height);
        user_weight = slicing(user_weight);
        predict_bmi = slicing(predict_bmi);

        now_bmi = user_weight/(Math.pow(user_height,2))*10000;
        predict_weight = predict_bmi[0]*(Math.pow(user_height,2)/10000);

        for (var i=0; i<model_input.length;i++){
            model_input[i] = model_input[i].replaceAll("'","");
        }
        console.log(model_input);

        predictgraph(Math.round(user_weight[0]*100)/100, Math.round(predict_weight*100)/100,Math.round(now_bmi*100)/100,Math.round(predict_bmi[0]*100)/100);

        drawPie(now_bmi, predict_bmi[0]);


        var ff_value = [];
        var ff_normal=[2,2,2,3];
        ff_value.push(model_input[0],model_input[1],model_input[2],model_input[3]);
        fastfoodgraph(label_name=['피자','햄버거','치킨','라면'],normal_x=ff_normal,y=ff_value);

        var snack_value = [];
        var snack_normal = [1,1,1,1];
        snack_value.push(model_input[4],model_input[5],model_input[6],model_input[7]);
        snackgraph(label_name=['아이스크림','과자','초콜릿','우유'], normal_x=snack_normal,y=snack_value);

        var drink_value = [];
        var drink_normal = [1,1,1]
        drink_value.push(model_input[8],model_input[9],model_input[10]);
        drinkgraph(label_name=['소주','맥주','막걸리'], normal_x=drink_normal,y=drink_value);
        
        var banchan_value = [];
        var banchan_normal = [1,1,4,1,3,3];
        banchan_value.push(model_input[11],model_input[12],model_input[13],model_input[14],model_input[15],model_input[16]);
        banchangraph(label_name=['콩나물','채소샐러드','달걀후라이/달걀말이','고등어/꽁치','된장찌개','김치찌개'], normal_x=banchan_normal,y=banchan_value);


    });

function slicing(variable) {
    var variable = variable+'';
    variable = variable.split(",");
    variable[0] = variable[0].replace("[","");
    variable[variable.length-1] = variable[variable.length-1].replace("]","");
    return variable;
}
function drawPie(now_bmi, predict_bmi){
    min_bmi = 18.09;
    max_bmi= 30.81;
    max_min_bmi = max_bmi-min_bmi;

    now_bmi_pct = Math.round(100*((now_bmi-min_bmi)/(max_min_bmi)));
    predict_bmi_pct = Math.round(100*((predict_bmi-min_bmi)/(max_min_bmi)-(now_bmi-min_bmi)/(max_min_bmi)));
    var num = Math.random(); 
    var data = { 
        labels: ["현재 BMI","예측 BMI","HIGHER THAN ME"], 
        datasets: [{ 
            data: [now_bmi_pct, predict_bmi_pct, 100-(now_bmi_pct+predict_bmi_pct)], 
            backgroundColor: ['#aecadc',
                    '#407bbf',
                    '#0e2f44'],
            borderColor:['#aecadc',
                    '#407bbf',
                    '#aecad'], 
        }]}
        window.onload = function() { var ctx = $('#pieChart').get(0).getContext("2d");
        var pieChart = new Chart(ctx, { 
            type: 'doughnut', 
            data: data, 
            options: { 
                responsive: true, 
                legend: { display: false },
                elements: { 
                    center: { 
                        text: Math.round(num*100), 
                        fontStyle: 'Helvetica', 
                        sidePadding: 15 //Default 20 (as a percentage) 
                    } 
                }, 
                maintainAspectRatio : false, 
                cutoutPercentage:70, 
                animation:false, 
                rotation: 1 * Math.PI, 
                circumference: 1 * Math.PI } 
            });

        }
}

function predictgraph(now_weight, predict_weight,now_bmi,predict_bmi){
    var ctx = document.getElementById('predict_canvas').getContext('2d');
    var myLineChart = new Chart(ctx, {
    type: 'bar',
    data : {
        labels:['현재','예측'],
        datasets:[
                {
                    label:'몸무게',
                    data:[now_weight,predict_weight],
                    backgroundColor:'rgb(100,149,237)',
                    borderColor:'rgb(100,149,237)',
                    borderWidth:1,
                    lineTension:0,
                    fill:false,

                },
                {
                label:'BMI',
                data:[now_bmi,predict_bmi],
                backgroundColor:'orange',
                borderColor:'orange',
                borderWidth:1,
                lineTension:0,
                fill:false,

                }
            ],
            },
    options: {
        tooltips: {
        titleFontSize: 30,
        bodyFontSize: 20
                },
        title: {
        display:true,
        text: "몸무게/BMI 분석",
        fontSize: 30
                },
        legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                            fontSize: 20,
                            fontFamily: 'sans-serif',
                            fontColor: '#000000',
                            fontStyle: 'bold'
                                }
                    },
        maintainAspectRatio : false,
        scales: {
        xAxes: [{
            categoryPercentage: 0.3,
            barPercentage: 1,
            ticks: {
                    fontSize : 20
                    },
                    gridLines: {
                        display:false
                                }
                    }],
        yAxes: [{
            ticks: {
                            min: 0,
                            max: 100,
                            fontSize : 20
                        },
            gridLines: {
                display:true,
                lineWidth: 0.3
                            }
                }]
                }
            } //option
    })//chart 닫기
    }//funtion닫기;

function fastfoodgraph(label_name,normal_x,y){
  var ctx = document.getElementById('ff_canvas').getContext('2d');
      var label_return = label_name;
      var x_date = normal_x;
      var y_return = y;
      var myLineChart = new Chart(ctx, {
        type: 'line',
        data : {
          labels:label_name,
          datasets:[
                    {
                      label:'정상체중인',
                      data:normal_x,
                      backgroundColor:'rgb(100,149,237)',
                      borderColor:'rgb(100,149,237)',
                      borderWidth:1,
                      lineTension:0,
                      fill:false,
                      pointRadius:3,
                      pointHoverRadius:1,
                      pointBorderColor:'rgb(100,149,237)',
                      pointBackgroundColor:'rgb(100,149,237)'
                    },
                  {
                    label:'본인',
                    data:y,
                    backgroundColor:'orange',
                    borderColor:'orange',
                    borderWidth:1,
                    lineTension:0,
                    fill:false,
                    pointRadius:3,
                    pointHoverRadius:1,
                    pointBorderColor:'orange',
                    pointBackgroundColor:'orange'
                  }
                ],
              },
        options: {
          title: {
            display:true,
            text: "패스트푸드",
            fontSize: 20,
                  },
          legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                      fontSize: 15,
                      fontColor: '#000000',
                                  }
                    },
          maintainAspectRatio : false,
           scales: {
             xAxes: [{
               ticks: {
                    fontSize : 15
                    },
                gridLines: {
                    display:false
                        }
            }],
             yAxes: [{
                ticks: {
                    fontSize : 15,
                        min: 0,
                        max: 9,
                        },
                 gridLines: {
                     display:true,
                     lineWidth: 0.3
                              }
                    }]
                  }
                } 
      })
};

function snackgraph(label_name,normal_x,y){
  var ctx = document.getElementById('ff_snack').getContext('2d');
      var label_return = label_name;
      var x_date = normal_x;
      var y_return = y;
      var myLineChart = new Chart(ctx, {
        type: 'line',
        data : {
          labels:label_name,
          datasets:[
                    {
                      label:'정상체중인',
                      data:normal_x,
                      backgroundColor:'rgb(100,149,237)',
                      borderColor:'rgb(100,149,237)',
                      borderWidth:1,
                      lineTension:0,
                      fill:false,
                      pointRadius:3,
                      pointHoverRadius:1,
                      pointBorderColor:'rgb(100,149,237)',
                      pointBackgroundColor:'rgb(100,149,237)'
                    },
                  {
                    label:'본인',
                    data:y,
                    backgroundColor:'orange',
                    borderColor:'orange',
                    borderWidth:1,
                    lineTension:0,
                    fill:false,
                    pointRadius:3,
                    pointHoverRadius:1,
                    pointBorderColor:'orange',
                    pointBackgroundColor:'orange'
                  }
                ],
              },
        options: {
          title: {
            display:true,
            text: "간식",
            fontSize: 20,
                  },
          legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                                fontSize: 15,
                                fontFamily: 'sans-serif',
                                fontColor: '#000000',

                                    }
                        },
          maintainAspectRatio : false,
           scales: {
             xAxes: [{
               ticks: {
                         fontSize : 15
                       },
                         gridLines: {
                             display:false
                                    }
                      }],
             yAxes: [{
                ticks: {
                                min: 0,
                                max: 9,
                                fontSize : 15
                             },
                 gridLines: {
                     display:true,
                     lineWidth: 0.3
                              }
                    }]
                  }
                } //option
      })
};

function banchangraph(label_name,normal_x,y){
  var ctx = document.getElementById('ff_banchan').getContext('2d');
      var label_return = label_name;
      var x_date = normal_x;
      var y_return = y;
      var myLineChart = new Chart(ctx, {
        type: 'line',
        data : {
          labels:label_name,
          datasets:[
                    {
                      label:'정상체중인',
                      data:normal_x,
                      backgroundColor:'rgb(100,149,237)',
                      borderColor:'rgb(100,149,237)',
                      borderWidth:1,
                      lineTension:0,
                      fill:false,
                      pointRadius:3,
                      pointHoverRadius:1,
                      pointBorderColor:'rgb(100,149,237)',
                      pointBackgroundColor:'rgb(100,149,237)'
                    },
                  {
                    label:'본인',
                    data:y,
                    backgroundColor:'orange',
                    borderColor:'orange',
                    borderWidth:1,
                    lineTension:0,
                    fill:false,
                    pointRadius:3,
                    pointHoverRadius:1,
                    pointBorderColor:'orange',
                    pointBackgroundColor:'orange'
                  }
                ],
              },
        options: {
          title: {
            display:true,
            text: "반찬",
            fontSize: 20
                  },
          legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                                fontSize: 15,
                                fontFamily: 'sans-serif',
                                fontColor: '#000000',

                                    }
                        },
          maintainAspectRatio : false,
           scales: {
             xAxes: [{
               ticks: {
                         fontSize : 10
                       },
                         gridLines: {
                             display:false
                                    }
                      }],
             yAxes: [{
                ticks: {
                                min: 0,
                                max: 9,
                                fontSize : 15
                             },
                 gridLines: {
                     display:true,
                     lineWidth: 0.3
                              }
                    }]
                  }
                } //option
      })
};

function drinkgraph(label_name,normal_x,y){
  var ctx = document.getElementById('ff_drink').getContext('2d');
      var label_return = label_name;
      var x_date = normal_x;
      var y_return = y;
      var myLineChart = new Chart(ctx, {
        type: 'line',
        data : {
          labels:label_name,
          datasets:[
                    {
                      label:'정상체중인',
                      data:normal_x,
                      backgroundColor:'rgb(100,149,237)',
                      borderColor:'rgb(100,149,237)',
                      borderWidth:1,
                      lineTension:0,
                      fill:false,
                      pointRadius:1,
                      pointHoverRadius:1,
                      pointBorderColor:'rgb(100,149,237)',
                      pointBackgroundColor:'rgb(100,149,237)'
                    },
                  {
                    label:'본인',
                    data:y,
                    backgroundColor:'orange',
                    borderColor:'orange',
                    borderWidth:1,
                    lineTension:0,
                    fill:false,
                    pointRadius:3,
                    pointHoverRadius:1,
                    pointBorderColor:'orange',
                    pointBackgroundColor:'orange'
                  }
                ],
              },
        options: {
          title: {
            display:true,
            text: "주류",
            fontSize: 20
                  },
          legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                                fontSize: 15,
                                fontFamily: 'sans-serif',
                                fontColor: '#000000',

                                    }
                        },
          maintainAspectRatio : false,
           scales: {
             xAxes: [{
               ticks: {
                         fontSize : 15
                       },
                         gridLines: {
                             display:false
                                    }
                      }],
             yAxes: [{
                ticks: {
                                min: 0,
                                max: 9,
                                fontSize : 15
                             },
                 gridLines: {
                     display:true,
                     lineWidth: 0.3
                              }
                    }]
                  }
                } //option
      })
};
</script>

{% endblock %}